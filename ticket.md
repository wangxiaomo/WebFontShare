
## TSEngine 实现思路以及遇到的问题 ##
---------------------------------------

- Timeline

  webfont && webfont loader -> 横向排版 -> hyphen -> mathjax -> 纵向排版 -> 加入图片样式后排版 -> 调优

- 实现思路以及遇到的问题

  1. 横向排版

  如果是纯汉字排版的话问题不是很大，尽管存在着标点符号所占宽度不一致的问题。段落中加入英文单词后需要考虑 Hyphen 对其的影响。
  既要满足横向宽度不超出，又要满足 Hyphen 断词，这时候就出现某些行留白过大。再加之中文排版中的行尾标点符号的特殊处理，无论
  是预读行尾标点符号并放在行尾，还是回溯上一字符并将字符放在下一行，这两中策略都会给不同的文字不同的段落造成不同的影响。后
  来又考虑到 mathjax 的处理。mathjax 在不同类型的文章中渲染的速度是不一样的，这在 js 排版过程中严重影响了排版效率（需要等待
  其渲染完毕后得到宽度，并进行排版）。加之生僻字符、mathjax 公式都是需要动态放入到 dom 中进行测量，所以在科学类文章中效率
  尤其的低。目前段落中的字体均为同样的字体，所以还没有将不同字体的字宽考虑进去(这会需要更多的 dom 测量操作)。

  尽量采取保守的策略可以使行宽不超出预设宽度。那么接下来工作的重心就放到了处理 letter-spacing 上面。

  字间距的话普遍采取的是填充空白的策略。填充的思路又有很多。这又是一个无限调优的过程。首先我们可以把当前排版后的行宽算出来，
  然后用预设的宽度与它进行运算，得出该行共需要补充多少宽度。接下来的思路会发散出很多。最简单的就是把需要补充的宽度均摊到每
  一个间隙中。但是多数情况下分摊到所有间隙中后会在浏览器端没有效果(算出来的 letter-spacing 均是比较小的小数，不足1px)。那么 
  换个思路，把留白填充到英文字符中。这种情况下又会出现当行内单词较少时，单词被严重拉伸的后果。再换个思路，将留白填充到英文
  单词和 mathjax 公式的两端。这种情况下受内容的影响。如果 mathjax 渲染前后宽度差异比较大时，也会出现很大的拉伸。将上面的策略
  混合起来使用，效率很低(因为有很多的预读判断。然后我又拿的 思考的乐趣 做测试，效果很烂。火狐多次卡死。)

  2. 纵向排版

  纵向排版首先使用的策略是先全部渲染出来，然后通过 div/jquery 来控制 scroll，这个方法简单，但是不适合正式运用，而且在文章文
  字较多的时候会出现卡死现象。然后 jay 一直说的 dom 测量行高策略一直没有加入，因为横向排版中效率已经不是很理想了。后来研究
  字节社、Kindle 的分页策略，感觉出应该是按照 line numbers 进行的(headline、图片等非文字段落有一定的转化比例)。所以和石头商
  量之后果断采用了这种分页方法。

  思路总结：*就是对宽度的测量和处理，重点取决于处理逻辑。*
